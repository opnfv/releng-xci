---
- hosts: openstack
  remote_user: root
  vars_files:
    - "{{ xci_path }}/xci/var/opnfv.yml"

  pre_tasks:
    - name: Load distribution variables
      include_vars:
        file: "{{ item }}"
      with_items:
        - "{{ xci_path }}/xci/var/{{ ansible_os_family }}.yml"
        - "{{ xci_flavor_ANSIBLE_FILE_PATH }}/flavor-vars.yml"
  roles:
    - role: bootstrap-host
    - role: configure-nfs
      when:
        - "'compute' in group_names"
    - role: configure-ceph
      when:
        - xci_ceph_enabled == "true"
        - "'compute' in group_names"
  tasks:
    - name: add public key to host
      copy:
        src: "{{ xci_path }}/xci/files/authorized_keys"
        dest: /root/.ssh/authorized_keys
