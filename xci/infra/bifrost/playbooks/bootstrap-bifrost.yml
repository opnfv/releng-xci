---
# SPDX-license-identifier: Apache-2.0
##############################################################################
# Copyright (c) 2017 Ericsson AB and others.
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
##############################################################################
- hosts: opnfv
  gather_facts: true
  vars_files:
    - "{{ xci_path }}/xci/var/opnfv.yml"
  pre_tasks:
    - name: Load distribution variables
      include_vars:
        file: "{{ xci_path }}/xci/var/{{ ansible_os_family }}.yml"
  roles:
    - role: clone-repository
      project: "opnfv/bifrost"
      repo: "{{ openstack_bifrost_git_url }}"
      dest: "{{ xci_cache }}/repos/bifrost"
      version: "{{ openstack_bifrost_version }}"

  tasks:
    - name: Load distribution variables
      include_vars:
        file: "{{ xci_path }}/xci/var/{{ ansible_os_family }}.yml"
    - name: Synchronize local development bifrost repository to XCI paths
      # command module is much faster than the copy module
      synchronize:
        src: "{{ openstack_bifrost_dev_path }}"
        dest: "{{ xci_cache }}/repos/bifrost"
        recursive: yes
        delete: yes
      when:
        - openstack_bifrost_dev_path != ""
    - name: combine opnfv/releng-xci and openstack/bifrost scripts/playbooks
      copy:
        src: "{{ xci_path}}/xci/infra/bifrost/"
        dest: "{{ xci_cache }}/repos/bifrost"
