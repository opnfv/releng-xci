---
# SPDX-license-identifier: Apache-2.0
##############################################################################
# Copyright (c) 2018 Orange and others.
#
# All rights reserved. This program and the accompanying materials
# are made available under the terms of the Apache License, Version 2.0
# which accompanies this distribution, and is available at
# http://www.apache.org/licenses/LICENSE-2.0
##############################################################################

#
# Check difference with actual inventories
#
- hosts: flavors
  connection: local
  vars:
    kubespray_path: ../../../../installer/kubespray/files
    osa_path: ../../../../installer/osa/files
  tasks:
    - name: recover flavor
      set_fact:
        xci_flavor: "{{ inventory_hostname }}"
    - name: create temporary folder
      tempfile:
        state: directory
        suffix: build
      register: tmpfolder
    - name: testing myself
      include_role:
        name: ../..
      vars:
        target_folder: "{{ tmpfolder.path }}"
    - name: compare inventory with osa installer
      shell:
        "diff {{Â osa_path }}/{{ xci_flavor }}/inventory \
        {{ tmpfolder.path }}/inventory_openstack"
    - name: compare inventory with kubespray installer
      shell:
        "diff {{ kubespray_path }}/{{ xci_flavor }}/inventory/inventory.cfg \
        {{ tmpfolder.path }}/inventory_k8s"
